# ������� ����� � �����������

## 1. ����

- ������� ����������� �� ��������� 24 �����.
- ������������ ����� `message_audit_logs` � `delivery_attempts` � �������� ���������� ��������.
- ��������� �������������� ������� ����� ��������� �������� �������.

## 2. Cron-������ (Kubernetes)

| Job                | ����������     | ������                                                                                 |
| ------------------ | -------------- | -------------------------------------------------------------------------------------- |
| `media-cleanup`    | `*/30 * * * *` | �� `message_media.expires_at` ������� ������� �� ������ � ��������������� ������ � ��. |
| `log-retention`    | `0 2 * * 1`    | ������ ���������� �� ��������� (per tenant/channel) � ������� ���� ������ 7 ����.      |
| `session-rotation` | `0 */6 * * *`  | ������� ������������ ����� WA-������ � �������� ��������� ������ � ��.                 |

## 3. ������� ������������

- ��������� ����� `@platform/maintenance` � ��������� `clean-media`, `clean-logs`, `rotate-sessions`.
- CronJob ��������� ��������� �� Node.js/TypeScript � �������� � PostgreSQL, Redis � S3.

## 4. ��������� �����

����� ��������� `log-retention` ��������� ������ � `tenant_weekly_metrics`:

- `messages_inbound`, `messages_outbound`
- `errors_jivo`, `errors_whatsapp`
- `avg_delivery_ms`

## 5. ����������

- ������� CronJob (�����/������������) �������������� � Prometheus.
- ����� ��� ���� ������ ����� `media-cleanup` ��� ����� ������ `message_audit_logs`, `delivery_attempts` ����� ������ (�� `pg_stat_user_tables`).
- ���� �������� �������� � `maintenance_run_logs`.

## 6. ������������

- ��������� �������� CronJob ����� ���������� ����������� ����� �� S3 � ��.

## 7. ������������

- �������������� ��������: ������ �������� ������/�����, ��������� job, ��������� �������.
- E2E: ���������� ���� �������� � S3 � ��������� ��������� ������� � �����.
